/**
 * plugin.js
 *
 * Copyright, BuizCore GmbH
 * Released under LGPL License.
 *
 */

/*global tinymce:true */

tinymce.PluginManager.add('bcpimage', function(editor) {
    
    function placeImage(){
        
        var tmpDate = new Date(),
            picIdKey = tmpDate.getTime();
        
        editor.insertContent(
            '<figure class="bcp-image-editor mceNonEditable" >'
            +' <div class="bcp-image-editor-controls" >'
            +' <button class="bcp-button bcpa-active-crop" >'
            +' <i class="fa fa-crop" ></i>'
            +' </button>'
            +' <button '
            +' class="bcp-button"'
            +' onclick="$(\'#content-image-1\').attr(\'src\',\'/static/images/default/placeholder.jpg\');" '
            +' ><i class="fa fa-remove" ></i></button>'
            +' </div>'
            +' <img class="bcp-e-img dz"'
            +' data-dz-type="embedded"'
            +'  id="content-image-1" '
            +' data-dz-target="/CmsImageEditor/upload.json?"'
            +' data-crop-target="/CmsImageEditor/cropImage.xml?"'
            +' data-img-name="placeholder.jpg"'
            +' src="/static/images/default/placeholder.jpg" '
            +' alt="Placeholder" />'
            +' </figure><p></p>'
        );
        
        console.debug('num figures '+$(editor.getContent()).find('figure').length);

        $(document).cmsEditor('initDropzone');
    };

    editor.addButton('bcpimage', {
        icon: 'image',
        tooltip: 'Insert/edit image',
        onclick: placeImage//,
        //stateSelector: 'img:not([data-mce-object],[data-mce-placeholder])'
    });

    editor.addMenuItem('bcpimage', {
        icon: 'image',
        text: 'Insert/edit image',
        onclick: placeImage,
        context: 'insert',
        prependToContext: true
    });

});
